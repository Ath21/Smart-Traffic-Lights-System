services:
  cyclist_detection_api:
    ports:
      - '5118:8080' # Optional if you want metrics/health endpoints exposed
    environment:
      ASPNETCORE_ENVIRONMENT: Development

      # RabbitMQ Config
      RabbitMQ__Host: rabbitmq
      RabbitMQ__Port: 5672
      RabbitMQ__Username: admin
      RabbitMQ__Password: admin123

      # RabbitMQ Exchanges
      RabbitMQ__Exchange__SensorDataExchange: sensor.data.exchange
      RabbitMQ__Exchange__LogStoreExchange: log.store.exchange

      # RabbitMQ Queues
      RabbitMQ__Queue__SensorCyclistDetectionRequestQueue: sensor.cyclist_detection.request.queue
      RabbitMQ__Queue__SensorLogsAuditQueue: sensor.logs.audit.queue
      RabbitMQ__Queue__SensorLogsErrorQueue: sensor.logs.error.queue

      # RabbitMQ Routing Keys
      RabbitMQ__RoutingKey__SensorCyclistDetectionRequestKey: sensor.cyclist_detection.request.*
      RabbitMQ__RoutingKey__SensorLogsAuditKey: sensor.cyclist_detection.logs.audit
      RabbitMQ__RoutingKey__SensorLogsErrorKey: sensor.cyclist_detection.logs.error

      # InfluxDB Config
      DetectionDb__Url: http://influxdb:8086
      DetectionDb__Token: admin-token
      DetectionDb__Org: DetectionOrg
      DetectionDb__Bucket: DetectionDb


    depends_on:
      influxdb:
        condition: service_started
    restart: always
