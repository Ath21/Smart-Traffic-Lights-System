apiVersion: v1
kind: ConfigMap
metadata:
  name: intersection-controller-config
  namespace: uniwa-stls
data:
  # --- ASP.NET Core ---
  ASPNETCORE_ENVIRONMENT: "Development"
  ASPNETCORE_URLS: "http://+:8080"
  SERVICE_LAYER: "Traffic"
  SERVICE_LEVEL: "Fog"
  SERVICE_NAME: "Intersection Controller"

  # --- Intersection Details ---
  Intersection__Id: "1"
  Intersection__Name: "Agiou Spyridonos"

  # --- Traffic Lights ---
  TrafficLights__0__Id: "101"
  TrafficLights__0__Name: "Agiou Spyridonos"
  TrafficLights__1__Id: "102"
  TrafficLights__1__Name: "Dimitsanas"

  # --- Redis (Traffic Light Cache) ---
  Redis__TrafficLight__Host: "traffic-light-cache-db"
  Redis__TrafficLight__Port: "6379"
  Redis__TrafficLight__Password: ""
  Redis__TrafficLight__Database: "0"
  Redis__TrafficLight__KeyPrefix__State: "traffic_light:{intersection}:{light}:state"
  Redis__TrafficLight__KeyPrefix__CurrentPhase: "traffic_light:{intersection}:{light}:phase"
  Redis__TrafficLight__KeyPrefix__RemainingTime: "traffic_light:{intersection}:{light}:remaining"
  Redis__TrafficLight__KeyPrefix__Duration: "traffic_light:{intersection}:{light}:duration"
  Redis__TrafficLight__KeyPrefix__LastUpdate: "traffic_light:{intersection}:{light}:last_update"
  Redis__TrafficLight__KeyPrefix__CycleDuration: "traffic_light:{intersection}:{light}:cycle_duration"
  Redis__TrafficLight__KeyPrefix__Offset: "traffic_light:{intersection}:{light}:offset"
  Redis__TrafficLight__KeyPrefix__LocalOffset: "traffic_light:{intersection}:{light}:local_offset"
  Redis__TrafficLight__KeyPrefix__CycleProgress: "traffic_light:{intersection}:{light}:cycle_progress"
  Redis__TrafficLight__KeyPrefix__Mode: "traffic_light:{intersection}:{light}:mode"
  Redis__TrafficLight__KeyPrefix__Priority: "traffic_light:{intersection}:{light}:priority"
  Redis__TrafficLight__KeyPrefix__CachedPhases: "traffic_light:{intersection}:{light}:cached_phases"
  Redis__TrafficLight__KeyPrefix__FailoverActive: "traffic_light:{intersection}:{light}:failover"
  Redis__TrafficLight__KeyPrefix__LastCoordinatorSync: "traffic_light:{intersection}:last_sync"
  Redis__TrafficLight__KeyPrefix__Heartbeat: "traffic_light:{intersection}:{light}:heartbeat"

  # --- Redis (Detection Cache) ---
  Redis__Host: "detection-cache-db"
  Redis__Port: "6379"
  Redis__Password: ""
  Redis__Database: "0"
  Redis__Sensor__KeyPrefix__VehicleCount: "sensor:{intersection}.vehicle_count"
  Redis__Sensor__KeyPrefix__PedestrianCount: "sensor:{intersection}.pedestrian_count"
  Redis__Sensor__KeyPrefix__CyclistCount: "sensor:{intersection}.cyclist_count"
  Redis__Detection__KeyPrefix__EmergencyDetections: "detection:{intersection}.emergency_vehicle_detected"
  Redis__Detection__KeyPrefix__PublicTransportDetections: "detection:{intersection}.public_transport_detected"
  Redis__Detection__KeyPrefix__IncidentDetections: "detection:{intersection}.incident_detected"

  # --- CORS ---
  Cors__AllowedOrigins: "http://localhost:5173,https://uniwa-stls.local"
  Cors__AllowedMethods: "GET,POST,PUT,PATCH,DELETE,OPTIONS"
  Cors__AllowedHeaders: "Content-Type,Authorization"

  # --- JWT ---
  Jwt__Issuer: "http://uniwa-stls-backend:8080"
  Jwt__Audience: "http://uniwa-stls-backend:8080"

  # --- RabbitMQ ---
  RabbitMQ__Host: "rabbitmq"
  RabbitMQ__VirtualHost: "/"
  RabbitMQ__Port: "5672"

  # --- Exchanges ---
  RabbitMQ__Exchanges__Sensor: "SENSOR.EXCHANGE"
  RabbitMQ__Exchanges__Traffic: "TRAFFIC.EXCHANGE"
  RabbitMQ__Exchanges__Log: "LOG.EXCHANGE"

  # --- Queues ---
  RabbitMQ__Queues__Sensor__SensorCount: "sensor-2-intersection-controller.{intersection}.queue"
  RabbitMQ__Queues__Sensor__DetectionEvents: "detection-2-intersection-controller.{intersection}.queue"
  RabbitMQ__Queues__Traffic__LightSchedule: "coordinator-2-intersection-controller.{intersection}.queue"

  # --- Routing Keys ---
  RabbitMQ__RoutingKeys__Sensor__SensorCount: "sensor.count.#"
  RabbitMQ__RoutingKeys__Sensor__DetectionEvents: "sensor.detection.#"
  RabbitMQ__RoutingKeys__Traffic__LightSchedule: "traffic.light.schedule.*"
  RabbitMQ__RoutingKeys__Traffic__PriorityCount: "priority.count.{intersection}.{type}"
  RabbitMQ__RoutingKeys__Traffic__PriorityDetection: "priority.detection.{intersection}.{event}"
  RabbitMQ__RoutingKeys__Traffic__LightControl: "traffic.light.control.{intersection}.{light}"
  RabbitMQ__RoutingKeys__Log__IntersectionController: "log.{layer}.{service}.{type}"
